<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Security groups for Internal Transfer Approval -->
    
    <!-- Group for users who can create approval requests -->
    <record id="group_approval_user" model="res.groups">
        <field name="name">Transfer Approval User</field>
        <field name="category_id" ref="base.module_category_inventory"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Group for users who can approve/reject requests -->
    <record id="group_approval_manager" model="res.groups">
        <field name="name">Transfer Approval Manager</field>
        <field name="category_id" ref="base.module_category_inventory"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user')), (4, ref('group_approval_user'))]"/>
    </record>

    <!-- Record rules for the approval request model -->
    
    <!-- Users can see their own requests -->
    <record id="rule_approval_request_user" model="ir.rule">
        <field name="name">Approval Request User Rule</field>
        <field name="model_id" ref="model_internal_approval_request"/>
        <field name="domain_force">[('requester_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_approval_user'))]"/>
    </record>

    <!-- Managers can see all requests -->
    <record id="rule_approval_request_manager" model="ir.rule">
        <field name="name">Approval Request Manager Rule</field>
        <field name="model_id" ref="model_internal_approval_request"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_approval_manager'))]"/>
    </record>

    <!-- Admins have full access -->
    <record id="rule_approval_request_admin" model="ir.rule">
        <field name="name">Approval Request Admin Rule</field>
        <field name="model_id" ref="model_internal_approval_request"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
    </record>

    <!-- Record rules for the approval request line model -->
    
    <!-- Users can see their own request lines -->
    <record id="rule_approval_request_line_user" model="ir.rule">
        <field name="name">Approval Request Line User Rule</field>
        <field name="model_id" ref="model_internal_approval_request_line"/>
        <field name="domain_force">[('request_id.requester_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_approval_user'))]"/>
    </record>

    <!-- Managers can see all request lines -->
    <record id="rule_approval_request_line_manager" model="ir.rule">
        <field name="name">Approval Request Line Manager Rule</field>
        <field name="model_id" ref="model_internal_approval_request_line"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_approval_manager'))]"/>
    </record>

    <!-- Admins have full access to lines -->
    <record id="rule_approval_request_line_admin" model="ir.rule">
        <field name="name">Approval Request Line Admin Rule</field>
        <field name="model_id" ref="model_internal_approval_request_line"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
    </record>
</odoo>
